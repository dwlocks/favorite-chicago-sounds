<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Favorite Chicago Sounds &mdash; Catalog</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="css/mainstyle.css" rel="stylesheet" type="text/css">
<link rel="icon" href="images/eq_browsertab.ico" type="image/x-icon" /> 
<link rel="shortcut icon" href="images/eq_browsertab.ico" type="image/x-icon" />
<script src="scripts/utils.js" language="javascript" type="text/javascript"></script>
<script type="text/javascript">
<!--
function MM_swapImgRestore() { //v3.0
  var i,x,a=document.MM_sr; for(i=0;a&&i<a.length&&(x=a[i])&&x.oSrc;i++) x.src=x.oSrc;
}
function MM_preloadImages() { //v3.0
  var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
    var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
    if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
}

function MM_findObj(n, d) { //v4.01
  var p,i,x;  if(!d) d=document; if((p=n.indexOf("?"))>0&&parent.frames.length) {
    d=parent.frames[n.substring(p+1)].document; n=n.substring(0,p);}
  if(!(x=d[n])&&d.all) x=d.all[n]; for (i=0;!x&&i<d.forms.length;i++) x=d.forms[i][n];
  for(i=0;!x&&d.layers&&i<d.layers.length;i++) x=MM_findObj(n,d.layers[i].document);
  if(!x && d.getElementById) x=d.getElementById(n); return x;
}

function MM_swapImage() { //v3.0
  var i,j=0,x,a=MM_swapImage.arguments; document.MM_sr=new Array; for(i=0;i<(a.length-2);i+=3)
   if ((x=MM_findObj(a[i]))!=null){document.MM_sr[j++]=x; if(!x.oSrc) x.oSrc=x.src; x.src=a[i+2];}
}
//-->
</script>
</head>

<body onLoad="MM_preloadImages('images/menu/jukebox_over.gif','images/menu/soundmaps_over.gif','images/menu/catalog_over.gif','images/menu/exhibits_over.gif','images/menu/participate_over.gif','images/menu/press_over.gif','images/menu/links_over.gif','images/menu/aboutus_over.gif')">

<table width="665" border="0" cellspacing="0" cellpadding="0" align="center">
  <tr>
    <td colspan="8" align="center"><a href="index.php"><img src="images/topmenu_01.gif" alt="Favorite Chicago Sounds" width="531" height="151" border="0" /></a></td>
  </tr>
  <tr>
    <td><a href="javascript:void(0);" onclick="javascript:openJukebox('jukebox.php','all');" target="_top" onClick="MM_nbGroup('down','group1','jukebox','images/menu/jukebox_on.gif',1)" onMouseOver="MM_nbGroup('over','jukebox','images/menu/jukebox_over.gif','images/menu/jukebox_over.gif',1)" onMouseOut="MM_nbGroup('out')"><img name="jukebox" src="images/menu/jukebox_off.gif" border="0" alt="Jukebox"></a></td>   
    <td><a href="soundmaps.php" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('sound maps','','images/menu/soundmaps_over.gif',1)"><img src="images/menu/soundmaps_off.gif" alt="sound maps" name="sound maps" width="108" height="15" border="0" id="sound maps" /></a></td>
    <td><a href="catalog.php" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('catalog','','images/menu/catalog_over.gif',1)"><img src="images/menu/catalog_on.gif" alt="catalog" name="catalog" width="77" height="15" border="0" id="catalog" /></a></td>
    <td><a href="exhibits.php" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('exhibits','','images/menu/exhibits_over.gif',1)"><img src="images/menu/exhibits_off.gif" alt="exhibits" name="exhibits" width="81" height="15" border="0" id="exhibits" /></a></td>
    <td><a href="participate.php" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('participate','','images/menu/participate_over.gif',1)"><img src="images/menu/participate_off.gif" alt="participate" name="participate" width="103" height="15" border="0" id="participate" /></a></td>
    <td><a href="press.php" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('press','','images/menu/press_over.gif',1)"><img src="images/menu/press_off.gif" alt="press" name="press" width="68" height="15" border="0" id="press" /></a></td>
    <td><a href="links.php" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('links','','images/menu/links_over.gif',1)"><img src="images/menu/links_off.gif" alt="links" name="links" width="63" height="15" border="0" id="links" /></a></td>
    <td><a href="aboutus.php" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('about us','','images/menu/aboutus_over.gif',1)"><img src="images/menu/aboutus_off.gif" alt="about us" name="about us" width="86" height="15" border="0" id="about us" /></a></td>
  </tr>
</table>

<div align="center"> 
<br><img src="images/horzline_wide.gif" width="700" height="1"><br>
  <table width="700" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
  	<td valign="top" > <span class="bodycopy">
	<strong><a href="catalog.php"><br>
	Read</a> | <a href="recordings.php">Listen</a> </strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Read what people have to say about their favorite sounds. Or listen directly to the MP3s.<br>
    <br></span>
    </td>
  </tr>
  <tr> 
    <td width="700" rowspan="3" align="left" valign="top" class="bodycopy"> 
		<span class="headline1"></span>
		<div style="text-align:left;width:100%;">
			<form method="get" action="catalog.php">
				search for: <input type="text" name="keyword" id="keyword" value="<?echo $_GET['keyword'] ?>" /> <input type="submit" value="Go" />
				<input type="hidden" name="page" id="page" value="1" />
			</form>
		</div>
		<br />
		<?php
		$keyword;
		if(isset($_GET['keyword'])) {
			$keyword = '%' . $_GET['keyword'] . '%';
		}
		else {
			$keyword = '%';
		}
		$page;
		$totResults;
		$maxResults = 15;
		if(isset($_GET['page'])) {
			$page = $_GET['page'];
		}
		else {
			$page = 1;
		}
		require_once('include/mysql_connect.php');
		
		$calcRowsQuery = "SELECT COUNT(*) as rows 
			FROM favorite_sounds as soundz 
			WHERE soundz.favSound LIKE '$keyword' OR soundz.whySound LIKE '$keyword'";
		$calcRowsRes = mysql_query($calcRowsQuery);
		$totResults = mysql_result($calcRowsRes, 0);
		$from = $maxResults * ($page - 1);
		
		$query = "SELECT soundz.id, soundz.favSound, soundz.whySound, soundz.fname, 
				soundz.lname, soundz.usename, soundz.dateAdded, MAX(recs.id) as recordingID
				FROM favorite_sounds as soundz LEFT JOIN recordings as recs on soundz.id = recs.sound_id
				WHERE soundz.favSound LIKE '$keyword' OR soundz.whySound LIKE '$keyword'
				GROUP BY id
				ORDER BY dateAdded DESC
				LIMIT $from, $maxResults";
		$result = mysql_query($query);
		$num = mysql_numrows($result);
		$i = 0;
		while ($i < $num) {
			$sound_id = mysql_result($result, $i, "id");
			$favSound = mysql_result($result, $i, "favSound");
			$whySound = mysql_result($result, $i, "whySound");
			$fname = mysql_result($result, $i, "fname");
			$lname = mysql_result($result, $i, "lname");
			$fullname = trim("$fname $lname");		
			$usename = mysql_result($result, $i, "usename");
			$recordingID = mysql_result($result, $i, "recordingID");
			
			if (!empty($favSound)) {
				echo '<p>';
				echo '<span class="headline2">' . $favSound . '</span><br>';
				if (!empty($whySound)) { 
					echo $whySound . '<br>';
				}
				if ($usename && !empty($fullname)) { 
					echo '<span class="smallertext">submitted by: ' . $fullname . '</span><br>';
				}
				
				// Check for comment count:
				$query2 = "SELECT COUNT(c5t.comment_identifier) as comment_count FROM c5t_comment as c5t WHERE c5t.comment_identifier LIKE '%sound_id=$sound_id' GROUP BY c5t.comment_identifier;";
				$result2 = mysql_query($query2);
				$comment_count = 0;
				if (mysql_numrows($result2) > 0) {
					$comment_count = mysql_result($result2, 0, "comment_count");
				}
				echo '<a onclick="window.open(\'recording_form.php?sound_id=' . $sound_id . '\',\'__upload\',\'width=400,height=500\');" href="javascript:void(0);">upload a recording</a> | <a href="link.php?sound_id=' . $sound_id . '">comments (' . $comment_count . ')</a>';
				echo '</p>';
				if (!empty($recordingID)) {
					echo '<p><img src="images/audio_icon4.gif" width="30" height="30" align="absmiddle"> <span class="headline2"><a onclick="javascript:openJukebox(\'jukebox.php?recording_id=' . $recordingID . '\', \'jukebox\')" href="javascript:void(0);" class="bodycopy">Listen</a></span></p>';
				}
				echo '<p><img src="images/horzline_wide.gif" width="700" height="1"></p>';
			}
			$i++;
		}
		echo '<div style="font-weight:bold;text-align:center;width:100%;">';
		if ($page != 1) {
			echo "<a href='catalog.php?keyword=" . $_GET['keyword'] . "&page=1'>&lt;&lt; First</a>&nbsp;&nbsp;&nbsp;";
			echo "<a href='catalog.php?keyword=" . $_GET['keyword'] . "&page=". ($page - 1) ."'>&lt; Previous</a>&nbsp;&nbsp;&nbsp;";
		}
		if ($page != 1 && $totResults > ($from + $maxResults)) {
			echo "&nbsp;|&nbsp;";	// separator
		}
		if ($totResults > ($from + $maxResults)) {
			echo "&nbsp;&nbsp;&nbsp;<a href='catalog.php?keyword=" . $_GET['keyword'] . "&page=". ($page + 1) ."'>Next &gt;</a>";
			echo "&nbsp;&nbsp;&nbsp;<a href='catalog.php?keyword=" . $_GET['keyword'] . "&page=". ceil($totResults / $maxResults) ."'>Last &gt;&gt;</a>";
		}
		echo '</div>';
		mysql_close();
		?>
	</td>       
  </tr>
  </table>
  </td>
  </tr>
  <tr> 
    <td valign="top" class="bodycopy">
		<p><br><br><br></p>
    </td>
  </tr>
 </table>
 <img src="images/horzline_wide.gif" width="700" height="1">
</div>
<?php include 'include/footer.php'; ?>
</body>
</html>